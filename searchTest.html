<!DOCTYPE HTML>
<html lang="en">

<head>
    <link rel="stylesheet" type="text/css" href="/aowp/Data/style.css">

    <script type="text/javascript" language="javascript" src="/aowp/Data/UnitAbilitiesNew.json"></script>
    <script type="text/javascript" language="javascript" src="/aowp/Data/UnitsNew.json"></script>
    <script type="text/javascript" language="javascript" src="/aowp/Data/BuilderNew.js"></script>
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <meta charset="UTF-8">
    <script>
        $("#body").ready(function() {

            $("#header").load("/aowp/header.html");

        });
        $(document).ready(function() {
            function showStats() {
                textFit(document.getElementsByClassName('unit_passiveslot'));
            }

            setTimeout(showStats, 500);
        });
    </script>
    <title>Age of Wonders Planetfall - Search Units</title>
</head>

<body>
    <div id="header"></div>
    <h2 style="color:white;text-align: center">Unit Search</h2>
    <p style="color:white;text-align: center">use "+" to search for up to 3 keywords <br> E.G: "cyborg+skirmisher+overwatch"</p>
    <br>
    <div style="margin-right: auto; margin-left: auto; width: 300px;">
        <input type="text" id="searchInput">
        <input type="submit" value="Submit" id="button">
        <div id="searchOutput">test</div>
    </div>

</body>
<script>
    $(document).ready(function() {
        $('#button').click(function() {
            searchData();
        });
    });

    function isInArray(array, search) {
        return array.indexOf(search) >= 0;
    }


    function searchData() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("searchInput");
        output = document.getElementById("searchOutput");
        output.innerHTML = "";


        filter = input.value.toUpperCase();
        var test = filter.replace(' ', "_");
        searchUnits(test);

    }

    function searchUnits(keyword) {
        var i, output, textvalue, j, l = "";

        var fields = keyword.split('+', 3);
        var list = new Array();
        output = document.getElementById("searchOutput");

        for (i = 0; i < jsonUnits.units.length; i++) {
            textvalue = jsonUnits.units[i].id;
            if (textvalue.toUpperCase().indexOf(fields[0]) > -1) {
                if (list.length >= 1) {
                    if (!isInArray(list, jsonUnits.units[i].id)) {
                        list.push(jsonUnits.units[i].id);
                    }
                } else {
                    list.push(jsonUnits.units[i].id);
                }



            }
            for (j = 0; j < jsonUnits.units[i].abilities.length; j++) {
                textvalue = jsonUnits.units[i].abilities[j].slug;
                if (textvalue.toUpperCase().indexOf(fields[0]) > -1) {
                    if (list.length >= 1) {
                        if (!isInArray(list, jsonUnits.units[i].id)) {
                            list.push(jsonUnits.units[i].id);
                        }
                    } else {
                        list.push(jsonUnits.units[i].id);
                    }



                }
            }
            for (j = 0; j < jsonUnits.units[i].passives.length; j++) {
                textvalue = jsonUnits.units[i].passives[j].slug;
                if (textvalue.toUpperCase().indexOf(fields[0]) > -1) {
                    if (list.length >= 1) {
                        if (!isInArray(list, jsonUnits.units[i].id)) {
                            list.push(jsonUnits.units[i].id);
                        }
                    } else {
                        list.push(jsonUnits.units[i].id);
                    }



                }
            }

            for (j = 0; j < jsonUnits.units[i].unit_types.length; j++) {
                textvalue = jsonUnits.units[i].unit_types[j].slug;
                if (textvalue.toUpperCase().indexOf(fields[0]) > -1) {
                    if (list.length >= 1) {
                        if (!isInArray(list, jsonUnits.units[i].id)) {
                            list.push(jsonUnits.units[i].id);
                        }
                    } else {
                        list.push(jsonUnits.units[i].id);
                    }



                }
            }



        }

        if (fields.length == 2) {
            var workinglist = list;
            list = new Array();

            list = searchUnitsMultiple(workinglist, fields[1]);



        }
        if (fields.length == 3) {
            var workinglist = list;
            list = new Array();

            list = searchUnitsMultiple(workinglist, fields[2]);



        }

        output.innerHTML = list.toString();
        for (j = 0; j < list.length; j++) {

            addUnitCard(list[j]);
        }

    }

    function searchUnitsMultiple(workinglist, fieldToSearch) {

        var newlist = new Array();
        for (i = 0; i < jsonUnits.units.length; i++) {
            textvalue = jsonUnits.units[i].id;
            if (textvalue.toUpperCase().indexOf(fieldToSearch) > -1 && isInArray(workinglist, jsonUnits.units[i].id)) {
                if (newlist.length >= 1) {
                    if (!isInArray(newlist, jsonUnits.units[i].id)) {
                        newlist.push(jsonUnits.units[i].id);
                    }
                } else {
                    newlist.push(jsonUnits.units[i].id);
                }



            }
            for (j = 0; j < jsonUnits.units[i].abilities.length; j++) {
                textvalue = jsonUnits.units[i].abilities[j].slug;
                if (textvalue.toUpperCase().indexOf(fieldToSearch) > -1 && isInArray(workinglist, jsonUnits.units[i].id)) {
                    if (newlist.length >= 1) {
                        if (!isInArray(newlist, jsonUnits.units[i].id)) {
                            newlist.push(jsonUnits.units[i].id);
                        }
                    } else {
                        newlist.push(jsonUnits.units[i].id);
                    }



                }
            }
            for (j = 0; j < jsonUnits.units[i].passives.length; j++) {
                textvalue = jsonUnits.units[i].passives[j].slug;
                if (textvalue.toUpperCase().indexOf(fieldToSearch) > -1 && isInArray(workinglist, jsonUnits.units[i].id)) {
                    if (newlist.length >= 1) {
                        if (!isInArray(newlist, jsonUnits.units[i].id)) {
                            newlist.push(jsonUnits.units[i].id);
                        }
                    } else {
                        newlist.push(jsonUnits.units[i].id);
                    }



                }
            }

            for (j = 0; j < jsonUnits.units[i].unit_types.length; j++) {
                textvalue = jsonUnits.units[i].unit_types[j].slug;
                if (textvalue.toUpperCase().indexOf(fieldToSearch) > -1 && isInArray(workinglist, jsonUnits.units[i].id)) {
                    if (newlist.length >= 1) {
                        if (!isInArray(newlist, jsonUnits.units[i].id)) {
                            newlist.push(jsonUnits.units[i].id);
                        }
                    } else {
                        newlist.push(jsonUnits.units[i].id);
                    }



                }
            }



        }
        return newlist;
    }

    function addUnitCard(unit) {
        var iDiv = document.createElement('div');
        // iDiv.setAttribute("id", "unit");
        // alert(unit);
        document.getElementById("searchOutput").appendChild(iDiv);
        $(iDiv).load("/aowp/unitcard.html", function() {
            showUnit(unit);
        });



    }

    function addSearchResultUnit(unit) {
        var output = document.getElementById("searchOutput");
        for (l = 0; l < jsonUnits.units.length; l++)
            if (unit == jsonUnits.units[l].name) {
                var holder = document.createElement("div");
                holder.className = ".unit_abilityslot ";
                var icon = document.createElement("img");
                icon.setAttribute("src", "/aow3db/Icons/UnitIcons/" + unit + ".png");
                var unitName = document.createElement("p");
                unitName.innerHTML = jsonUnits.units[l].string;
                output.innerHTML = "done the thing";
                output.appendChild(holder);
                holder.appendChild(icon);
                holder.append(unitName);
            } else {
                output.innerHTML = "done some thing";
            }

    }
</script></html>
